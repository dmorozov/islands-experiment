# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a research project exploring Islands Architecture using Quarkus (Java backend) with Astro (UI framework). The main application is located in `quarkus-astro-app/` and uses Quarkus Quinoa to integrate Astro within the Quarkus application.

## Tech Stack

**Backend:**
- Quarkus 3.29.4 (Java 21)
- Quarkus REST (JAX-RS)
- SmallRye OpenAPI
- WebSockets Next
- Quinoa 2.7.0 (integrates Node.js-based frontends with Quarkus)

**Frontend (in `quarkus-astro-app/src/main/webui`):**
- Astro (Islands Architecture)
- Preact (planned for interactive islands)
- TypeScript
- Tailwind CSS (planned)
- Shadcn UI (planned)
- TanStack Query with Axios (planned for API calls)
- Orval (planned for generating API client from OpenAPI schema)

**Build Tools:**
- Maven (Java/Quarkus)
- npm (Astro/frontend)
- Checkstyle & PMD for Java code quality

## Architecture

### Quarkus Quinoa Integration

The project uses Quarkus Quinoa to seamlessly integrate the Astro frontend with the Quarkus backend:
- Frontend source: `quarkus-astro-app/src/main/webui`
- Frontend build output: `quarkus-astro-app/src/main/webui/dist`
- Quinoa manages Node.js/npm installation (Node 20.17.0, npm 10.8.2)
- API endpoints prefixed with `/api` are handled by Quarkus
- All other routes are served by Astro

### Development Ports

- Quarkus server: `http://localhost:7171`
- Astro dev server (during dev mode): `http://localhost:3000`
- When running `quarkus dev`, access the app at: `http://localhost:7171/`

### OpenAPI Integration

- OpenAPI schema is auto-generated by Quarkus
- Schema is stored at: `quarkus-astro-app/src/main/webui/api`
- Swagger UI available at: `http://localhost:7171/swagger-ui`
- Use Orval to generate TypeScript API client from this schema

## Development Commands

### Running the Application

```bash
# From project root or quarkus-astro-app directory
quarkus dev
```

This starts Quarkus in dev mode with hot reload. Quinoa automatically manages the Astro dev server.

### Building

```bash
# Build entire project (from root)
./mvnw clean package

# Build just the Quarkus app
cd quarkus-astro-app
./mvnw clean package
```

### Testing

```bash
# Run unit tests
./mvnw test

# Run integration tests
./mvnw verify

# Run with native profile (requires GraalVM)
./mvnw package -Pnative
```

### Frontend Development

```bash
# Navigate to frontend directory
cd quarkus-astro-app/src/main/webui

# Install dependencies
npm install

# Run Astro dev server standalone (port 3000)
npm run dev

# Build frontend only
npm run build

# Preview production build
npm run preview
```

### Code Quality

The parent POM enforces Checkstyle and PMD:
- Checkstyle config: `build-tools/src/main/resources/product/checkstyle.xml`
- PMD ruleset: `build-tools/src/main/resources/product/pmd-ruleset.xml`
- Suppressions: `build-tools/src/main/resources/product/checkstyle-suppressions.xml`

```bash
# Validate code quality (runs automatically on validate phase)
./mvnw validate

# Generate quality reports
./mvnw site
```

## Project Structure

```
.
├── quarkus-astro-app/          # Main application
│   ├── src/main/
│   │   ├── java/               # Quarkus backend (currently empty)
│   │   ├── resources/
│   │   │   └── application.properties  # Quarkus config
│   │   └── webui/              # Astro frontend
│   │       ├── src/
│   │       │   ├── components/ # Astro components
│   │       │   ├── layouts/    # Astro layouts
│   │       │   └── pages/      # Astro pages (file-based routing)
│   │       ├── astro.config.mjs
│   │       └── package.json
│   └── pom.xml
├── parent/                     # Parent POM with shared config
├── build-tools/                # Checkstyle/PMD configurations
└── pom.xml                     # Root aggregator POM
```

## Key Configuration Files

**`quarkus-astro-app/src/main/resources/application.properties`:**
- HTTP port: 7171
- Quinoa UI directory: `src/main/webui`
- Quinoa build directory: `dist`
- API path prefix: `/api` (ignored by Quinoa, handled by Quarkus)
- OpenAPI schema export location: `src/main/webui/api`

## Planned Features

Based on README requirements, the following integrations are planned but not yet implemented:
- Preact integration with TypeScript
- Tailwind CSS setup
- Shadcn UI components
- TanStack Query for API calls
- Orval for API client generation from OpenAPI schema
- Prettier and ESLint configuration

## AI Development Tools

The project is set up to work with:
- SpecKit: Specification-driven development workflow
- Claude Code: This tool
- Gemini CLI: Alternative AI coding assistant

Refer to README.md for installation and usage of these tools.
